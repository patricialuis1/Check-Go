<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Check&Go - Administração</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/dashboardAdmin.css" />
  <link rel="stylesheet" href="/css/layoutAdmin.css" />

  <script type="module">
    import { requireAuth } from "/js/autenticacao/auth.js";
    requireAuth();
  </script>
  
</head>
<body>
  <div class="layout-principal">
    <!-- BARRA LATERAL -->
    <aside class="barra-lateral">
      <div class="cabecalho-lateral">
        <span class="linha-titulo"></span>
        <span class="titulo-lateral">Administração</span>
      </div>

      <div class="cartao-logo">
        <img src="/imagens/Check_Go__3_-removebg-preview.png"
             alt="Logo Check&Go"
             class="imagem-logo" />
      </div>

      <div class="secao-utilizador">
        <div class="nome-utilizador">Tomás Ribeiro</div>
        <div class="cargo-utilizador">Admin</div>
      </div>

      <nav class="menu-lateral">
        <a href="/views/admin/dashboard.html" class="item-menu item-menu-ativo">
          <span class="icone-menu">
            <img src="/imagens/icons/home.png" alt="Home">
          </span>
          <span class="texto-menu">Home</span>
        </a>

        <a href="/views/admin/abaLoja/listaLoja.html" class="item-menu">
          <span class="icone-menu">
            <img src="/imagens/icons/lojas.png" alt="Lojas">
          </span>
          <span class="texto-menu">Lojas</span>
        </a>

        <a href="/views/admin/abaColaborador/listaColaborador.html" class="item-menu">
          <span class="icone-menu">
            <img src="/imagens/icons/colaborador.png" alt="Colaboradores">
          </span>
          <span class="texto-menu">Colaboradores</span>
        </a>

        <a href="/views/admin/abaServico/listaServico.html" class="item-menu">
          <span class="icone-menu">
            <img src="/imagens/icons/servicos.png" alt="Serviços">
          </span>
          <span class="texto-menu">Serviços</span>
        </a>

        <a href="/views/colaborador/escolherservico.html" class="item-menu">
          <span class="icone-menu">
            <img src="/imagens/icons/voltarColab.png" alt="Voltar como Colab">
          </span>
          <span class="texto-menu">Voltar como Colab</span>
        </a>
      </nav>

      <div class="rodape-lateral">
        <a href="/views/autenticacao/logout.html" class="link-logout">
          <span class="texto-logout">Logout</span>
          <span class="icone-logout">
            <img src="/imagens/icons/logout.png" alt="Logout">
          </span>
        </a>
      </div>
    </aside>

    <!-- CONTEÚDO PRINCIPAL -->
    <main class="area-conteudo">
      <section class="painel-resumo">
        <a href="/views/admin/abaColaborador/listaColaborador.html" class="cartao-resumo cartao-azul">
          <div class="icone-cartao">
            <img src="/imagens/icons/colaborador.png" alt="Colaboradores">
          </div>
          <div class="legenda-cartao">Colaboradores</div>
          <div class="valor-cartao" id="total-colaboradores">...</div>
        </a>

        <a href="/views/admin/abaLoja/listaLoja.html" class="cartao-resumo cartao-rosa">
          <div class="icone-cartao">
            <img src="/imagens/icons/lojas.png" alt="Lojas">
          </div>
          <div class="legenda-cartao">Lojas</div>
          <div class="valor-cartao" id="total-lojas">...</div>
        </a>

        <a href="/views/admin/abaServico/listaServico.html" class="cartao-resumo cartao-verde">
          <div class="icone-cartao">
            <img src="/imagens/icons/servicos.png" alt="Serviços">
          </div>
          <div class="legenda-cartao">Serviços</div>
          <div class="valor-cartao" id="total-servicos">...</div>
        </a>
      </section>
    </main>
  </div>
  <script>

    document.addEventListener("DOMContentLoaded", async () => {
    
    const userStr = localStorage.getItem("auth_user");
    if (!userStr) return; 
    
    const user = JSON.parse(userStr);
    const token = user.sessionToken;

    const options = {
        method: "GET",
        headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
        }
    };

    async function atualizarContador(endpoint, elementoId) {
        try {
            const res = await fetch(endpoint, options);
            if (res.ok) {
                const lista = await res.json();
                
                if (Array.isArray(lista)) {
                    const el = document.getElementById(elementoId);
                    if (el) el.innerText = lista.length; 
                }
            } else {
                console.error(`Erro ao carregar ${endpoint}:`, res.status);
            }
        } catch (err) {
            console.error(err);
        }
    }

    atualizarContador("/colaboradores", "total-colaboradores");
    atualizarContador("/lojas", "total-lojas");
    atualizarContador("/servicos", "total-servicos");
  });
  </script>
</body>
</html>
